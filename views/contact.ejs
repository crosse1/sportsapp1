<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/custom.css">
    <style>
        body {
            background: linear-gradient(to right, #7e22ce, #14b8a6);
        }

        .gradient-text {
    background: linear-gradient(to right, #14b8a6, #7e22ce);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text; /* for Firefox */
    color: transparent;
    font-weight: bold;
}

/* Profile image preview */
.profile-image-preview {
    width: 8rem;
    height: 8rem;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid rgba(255,255,255,0.8);
    display: block;
    margin: 0 auto 1rem auto;
}


    </style>
</head>
<body class="d-flex justify-content-center align-items-center min-vh-100">
    <div class="card shadow p-4" style="max-width: 450px; width: 100%;">
        <h1 class="text-center mb-4 gradient-text">Create Account</h1>
        <form action="/signup" method="post" enctype="multipart/form-data">
            <% if (typeof error !== 'undefined') { %>
                <div class="alert alert-danger"><%= error %></div>
            <% } %>
            <div class="position-relative mb-3">
            <input type="text" id="username" name="username" placeholder="Username" class="form-control gradient-input pe-5" maxlength="20" pattern="^[a-zA-Z0-9_]+$" required>
            <span id="usernameStatus" class="username-status"></span>
        </div>
            <input type="email" name="email" placeholder="Email" class="form-control gradient-input mb-3" required>
            <input type="password" name="password" placeholder="Password" class="form-control gradient-input mb-3" required>
            <input type="text" id="phoneNumber" name="phoneNumber" placeholder="Phone Number" pattern="\d{3}-\d{3}-\d{4}" class="form-control gradient-input mb-3" required>
            <input type="file" name="profileImage" id="profileImageInput" accept="image/*" class="d-none" required>
            <label for="profileImageInput" id="profileImageLabel" class="gradient-input file-input-label mb-3  d-block">Click to add Profile Image</label>
            <img id="profileImagePreview" class="profile-image-preview d-none" alt="Profile Preview">
            <button type="submit" class="btn w-100 text-white gradient-glass-btn">Sign Up</button>
        </form>
        <div class="text-center mt-3">
            <a href="/login" class="text-decoration-none">Already have an account? Sign in</a>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const fileInput = document.getElementById('profileImageInput');
        const fileLabel = document.getElementById('profileImageLabel');
        const imagePreview = document.getElementById('profileImagePreview');
        fileInput.addEventListener('change', function(){
            fileLabel.textContent = this.files[0] ? this.files[0].name : 'Profile Image';
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    imagePreview.src = e.target.result;
                    imagePreview.classList.remove('d-none');
                };
                reader.readAsDataURL(this.files[0]);
            } else {
                imagePreview.src = '';
                imagePreview.classList.add('d-none');
            }
        });
        const phoneInput = document.getElementById('phoneNumber');
        phoneInput.addEventListener('input', () => {
            let val = phoneInput.value.replace(/\D/g, '').substring(0,10);
            if (val.length > 6) {
                val = `${val.slice(0,3)}-${val.slice(3,6)}-${val.slice(6)}`;
            } else if (val.length > 3) {
                val = `${val.slice(0,3)}-${val.slice(3)}`;
            }
            phoneInput.value = val;
        });
        const usernameInput = document.getElementById("username");
        const usernameStatus = document.getElementById("usernameStatus");
        let usernameTimer;
        usernameInput.addEventListener("input", function(){
            clearTimeout(usernameTimer);
            const val = this.value.trim();
            if(!val){
                usernameStatus.textContent = "";
                return;
            }
            usernameTimer = setTimeout(async () => {
                try{
                    const res = await fetch(`/check-username/${encodeURIComponent(val)}`);
                    const data = await res.json();
                    if(data.available){
                        usernameStatus.textContent = "✅";
                        usernameStatus.style.color = "green";
                    }else{
                        usernameStatus.textContent = "❌";
                        usernameStatus.style.color = "red";
                    }
                }catch(e){
                    usernameStatus.textContent = "";
                }
            }, 300);
        });
    </script>
</body>
</html>
