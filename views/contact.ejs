<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/custom.css">
    <style>
        body {
            background: linear-gradient(to right, #7e22ce, #14b8a6);
        }

        .gradient-text {
    background: linear-gradient(to right, #14b8a6, #7e22ce);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text; /* for Firefox */
    color: transparent;
    font-weight: bold;
}

/* Glassy select2 styling */
.select2-container--default .select2-selection--multiple {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 0.5rem;
    padding: 0.5rem;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    position: relative;
    overflow: visible; /* keep search field visible */
    color: #fff;
    font-weight: bold;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice {
    background: rgba(255, 255, 255, 0.15); /* translucent for depth */
    color: white;
    font-weight: bold;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.5rem;
    backdrop-filter: blur(10px) saturate(150%);
    -webkit-backdrop-filter: blur(10px) saturate(150%);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 0 6px rgba(255, 255, 255, 0.1);
    padding: 6px 10px;
    margin: 4px 6px 4px 0;
    transition: all 0.25s ease-in-out;
}

.select2-container--default .select2-selection--multiple .select2-selection__rendered {
    color: white;
    font-weight: bold;
}

/* Ensure search text is visible */
.select2-container--default .select2-search--inline .select2-search__field,
.select2-container--default .select2-search--dropdown .select2-search__field {
    color: #fff;
}

.select2-container--default .select2-results__option {
    background: linear-gradient(to right, #14b8a6, #7e22ce);
    color: #fff;
    font-weight: bold;
    border-radius: 0.3rem;
    margin: 2px 4px;
    padding: 6px 10px;
    backdrop-filter: blur(6px);
}
.select2-container--default .select2-results__option--highlighted[aria-selected] {
    background: linear-gradient(to right, #7e22ce, #14b8a6);
    color: #fff;
}
.select2-container .select2-dropdown {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border: none;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.select2-container--default .select2-selection--multiple .select2-selection__choice {
    background: rgba(255, 255, 255, 0.1); /* transparent enough for blur */
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 0.5rem;
    backdrop-filter: saturate(180%) blur(12px);
    -webkit-backdrop-filter: saturate(180%) blur(12px); /* Safari */
    box-shadow: 0 4px 8px rgba(0,0,0,0.1), inset 0 0 8px rgba(255,255,255,0.1);
    color: white;
    font-weight: 600;
    padding: 6px 12px;
    margin: 3px;
    transition: all 0.2s ease-in-out;
}

/* Profile image preview */
.profile-image-preview {
    width: 8rem;
    height: 8rem;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid rgba(255,255,255,0.8);
    display: block;
    margin: 0 auto 1rem auto;
}

    </style>
</head>
<body class="d-flex justify-content-center align-items-center min-vh-100">
    <div class="card shadow p-4" style="max-width: 450px; width: 100%;">
        <h1 class="text-center mb-4 gradient-text">Create Account</h1>
        <form action="/signup" method="post" enctype="multipart/form-data">
            <% if (typeof error !== 'undefined') { %>
                <div class="alert alert-danger"><%= error %></div>
            <% } %>
            <div class="position-relative mb-3">
            <input type="text" id="username" name="username" placeholder="Username" class="form-control gradient-input pe-5" maxlength="20" pattern="^[a-zA-Z0-9_]+$" required>
            <span id="usernameStatus" class="username-status"></span>
        </div>
            <input type="email" name="email" placeholder="Email" class="form-control gradient-input mb-3" required>
            <input type="password" name="password" placeholder="Password" class="form-control gradient-input mb-3" required>
            <input type="text" id="phoneNumber" name="phoneNumber" placeholder="Phone Number" pattern="\d{3}-\d{3}-\d{4}" class="form-control gradient-input mb-3" required>
            <input type="file" name="profileImage" id="profileImageInput" accept="image/*" class="d-none" required>
            <label for="profileImageInput" id="profileImageLabel" class="gradient-input file-input-label mb-3  d-block">Click to add Profile Image</label>
            <img id="profileImagePreview" class="profile-image-preview d-none" alt="Profile Preview">
            <select name="favoriteTeams" class="favoriteTeams-select gradient-input mb-4" multiple required>
                <% teams.filter(t => t.leagueId === 1 || t.leagueId === 8).forEach(t => { %>
                    <option value="<%= t._id %>" data-logo="<%= t.logos && t.logos[0] ? t.logos[0] : '' %>"><%= t.school %> <%= t.mascot %></option>
                <% }); %>
            </select>
            <br>
            <br>
            <button type="submit" class="btn w-100 text-white gradient-glass-btn">Sign Up</button>
        </form>
        <div class="text-center mt-3">
            <a href="/login" class="text-decoration-none">Already have an account? Sign in</a>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        function formatTeam (option) {
            if (!option.id) return option.text;
            var logo = $(option.element).data('logo');
            if (logo) {
                return $('<span><img src="'+logo+'" style="width:20px;height:20px;margin-right:5px;">'+option.text+'</span>');
            }
            return option.text;
        }
        $(function(){
            $('.favoriteTeams-select').select2({
                placeholder:'Favorite Teams',
                width: '100%',
                templateResult: formatTeam,
                templateSelection: formatTeam
            });
        });
        const fileInput = document.getElementById('profileImageInput');
        const fileLabel = document.getElementById('profileImageLabel');
        const imagePreview = document.getElementById('profileImagePreview');
        fileInput.addEventListener('change', function(){
            fileLabel.textContent = this.files[0] ? this.files[0].name : 'Profile Image';
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    imagePreview.src = e.target.result;
                    imagePreview.classList.remove('d-none');
                };
                reader.readAsDataURL(this.files[0]);
            } else {
                imagePreview.src = '';
                imagePreview.classList.add('d-none');
            }
        });
        const phoneInput = document.getElementById('phoneNumber');
        phoneInput.addEventListener('input', () => {
            let val = phoneInput.value.replace(/\D/g, '').substring(0,10);
            if (val.length > 6) {
                val = `${val.slice(0,3)}-${val.slice(3,6)}-${val.slice(6)}`;
            } else if (val.length > 3) {
                val = `${val.slice(0,3)}-${val.slice(3)}`;
            }
            phoneInput.value = val;
        });
        const usernameInput = document.getElementById("username");
        const usernameStatus = document.getElementById("usernameStatus");
        let usernameTimer;
        usernameInput.addEventListener("input", function(){
            clearTimeout(usernameTimer);
            const val = this.value.trim();
            if(!val){
                usernameStatus.textContent = "";
                return;
            }
            usernameTimer = setTimeout(async () => {
                try{
                    const res = await fetch(`/check-username/${encodeURIComponent(val)}`);
                    const data = await res.json();
                    if(data.available){
                        usernameStatus.textContent = "✅";
                        usernameStatus.style.color = "green";
                    }else{
                        usernameStatus.textContent = "❌";
                        usernameStatus.style.color = "red";
                    }
                }catch(e){
                    usernameStatus.textContent = "";
                }
            }, 300);
        });
    </script>
</body>
</html>
