<link rel="stylesheet" href="/css/custom.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<header class="shadow-sm bg-white">
  <nav class="container d-flex align-items-center justify-content-between py-3">
    <a href="/" class="fw-bold fs-4 text-decoration-none px-3 py-1 rounded-pill <%= currentPath === '/' ? 'bg-primary text-white' : 'text-body' %>">App Logo</a>
    <ul class="d-none d-md-flex list-unstyled mb-0 gap-3">
      <li>
        <a href="/games" class="text-decoration-none px-3 py-1 rounded-pill <%= currentPath.startsWith('/games') ? 'bg-primary text-white' : 'text-body' %>">Games</a>
      </li>
      <li><a href="/social" class="text-decoration-none px-3 py-1 rounded-pill <%= currentPath.startsWith('/social') ? 'bg-primary text-white' : 'text-body' %>">Social</a></li>
      
    </ul>
    <div class="text-nowrap d-flex align-items-center">
      <% if (loggedInUser) { %>
        <a href="#" id="navInbox" data-unread="<%= hasUnreadMessages ? '1' : '' %>" data-new-followers="<%= hasNewFollowers ? '1' : '' %>" class="me-3 position-relative <%= currentPath.startsWith('/messages') ? 'text-primary' : 'text-body' %>">
          <i class="bi bi-envelope-fill fs-4"></i>
          <% if(hasUnreadMessages || hasNewFollowers){ %>
            <span class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle inbox-dot"></span>
          <% } %>
        </a>
        <% const navProfileSlug = loggedInUser && (loggedInUser.venmo || loggedInUser.id); %>
        <a href="<%= navProfileSlug ? `/profile/${navProfileSlug}/stats` : '/profile' %>" class="me-3 <%= currentPath.startsWith('/profile') ? 'active-profile' : '' %>">
          <img src="<%= navImg %>" alt="Profile" class="nav-profile-icon">
        </a>
        <button id="settingsButton" class="btn btn-light rounded-circle shadow-sm settings-gear-btn" aria-label="Open settings">
          ⚙️
        </button>
      <% } else { %>
        <a href="/login" class="btn btn-outline-primary me-2">Sign In</a>
        <a href="/signup" class="btn btn-primary">Register</a>
      <% } %>
    </div>
  </nav>
</header>
<div id="settingsDrawerOverlay" class="settings-overlay"></div>
<aside id="settingsDrawer" class="settings-drawer">
  <div class="d-flex justify-content-between align-items-start mb-4">
    <div>
      <h5 class="mb-1">Settings</h5>
      <p class="text-muted mb-0">Manage your preferences</p>
    </div>
    <button class="btn btn-link text-muted p-0" id="settingsDrawerClose" aria-label="Close settings">
      <i class="bi bi-x-lg fs-5"></i>
    </button>
  </div>
  <div id="settingsStatus" class="alert alert-dismissible fade d-none" role="alert"></div>
  <div class="settings-stack">
    <div class="settings-card">
      <div class="d-flex align-items-center justify-content-between gap-3">
        <div>
          <div class="fw-semibold">Get friends game notifications</div>
          <div class="text-muted small">Receive waitlist notifications for followed users</div>
        </div>
        <label class="toggle-switch mb-0" aria-label="Toggle waitlist notifications">
          <input type="checkbox" id="notifyWaitlistToggle" data-initial="<%= userSettings?.notifyWaitlist ? 'true' : 'false' %>" <%= userSettings?.notifyWaitlist ? 'checked' : '' %> />
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>
    <div class="settings-card">
      <div class="d-flex flex-column gap-3">
        <div class="d-flex justify-content-between align-items-center">
          <div class="fw-semibold">Forgot Password</div>
          <button id="togglePasswordForm" class="btn btn-outline-primary btn-sm">Reset</button>
        </div>
        <form id="passwordChangeForm" class="d-none">
          <div class="mb-3">
            <label for="oldPassword" class="form-label">Old password</label>
            <input type="password" class="form-control" id="oldPassword" name="oldPassword" autocomplete="current-password" required>
          </div>
          <div class="mb-3">
            <label for="newPassword" class="form-label">New password</label>
            <input type="password" class="form-control" id="newPassword" name="newPassword" autocomplete="new-password" required>
          </div>
          <div class="mb-3">
            <label for="confirmPassword" class="form-label">Confirm new password</label>
            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" autocomplete="new-password" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">Update password</button>
        </form>
      </div>
    </div>
    <div class="settings-card">
      <a href="/logout" class="btn btn-outline-danger w-100">Log Out</a>
    </div>
  </div>
</aside>
<div class="modal fade" id="inboxModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content"></div>
  </div>
</div>
<script src="/js/inboxModal.js"></script>
<script>window.loggedInUser = <%- JSON.stringify(loggedInUser || null) %>;</script>
<script>window.hasQueuedGameInvites = <%= JSON.stringify(!!hasQueuedGameInvites) %>;</script>
<script>window.userSettings = <%- JSON.stringify(userSettings || { notifyWaitlist: false }) %>;</script>
<script src="/js/nearbyCheckin.js"></script>

<%- include('ratePromptModal') %>
<%- include('gameInviteModal') %>

<script>window.pendingRatings = <%- JSON.stringify(pendingRatings || []) %>;</script>
<script src="/js/pendingRatingModal.js"></script>
<script src="/js/gameInviteModal.js"></script>
<script src="/js/settingsDrawer.js"></script>
