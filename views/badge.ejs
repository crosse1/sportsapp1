<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= badge.badgeName %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/custom.css">
  <style>
    .badge-detail-wrapper .badge-icon-container {
      width: 20rem;
      height: 20rem;
      border-radius: 50%;
      margin-left: -5rem;
    }
    .badge-detail-wrapper .badge-icon {
      pointer-events: none;
    }
    .glassy-box {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 0.75rem;
      color: white;
      padding: 1rem;
    }
    .diamond-text {
      font-weight: bold;
      background: linear-gradient(90deg, #ffffff, #e0dceb);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: center;
      font-size: 1.2rem;
    }

    .game-card {
  color: white !important;
}

.game-card .team-name,
.game-card .game-date,
.game-card .at-symbol {
  color: white !important;
}

.game-card a {
  color: white !important;
}

.diamond-text {
  font-weight: bold;
  font-size: 2.5rem;
  color: white; /* solid white */
  text-align: center;
  margin-bottom: 2rem;
  margin-left: -5rem;
  font-size: 1.2rem;
}

.badge-description {
  color: white;           /* solid white */
  text-align: left !important;  /* override any inherited center */
  display: block;
  width: 100%;
}

/* Make the badge size a variable so everything can scale from it */
.badge-detail-wrapper .badge-icon-container {
  --badge-size: 20rem;              /* change this to scale the whole badge */
  width: var(--badge-size);
  height: var(--badge-size);
  border-radius: 50%;
  margin-left: -5rem;
  position: relative;               /* ensure overlay layers can fill */
  overflow: hidden;
}

/* Scale the ‚Äú2025‚Äù layers with the badge size */
.special-badge-metal-bg,
.gold-badge-metal-bg,
.bronze-badge-metal-bg {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  pointer-events: none;
  font-size: calc(var(--badge-size) * 0.22);  /* <-- key: scales with badge */
  line-height: 0.9;
}

/* If spans had a fixed font-size in the partial, override it */
.special-badge-metal-bg span,
.gold-badge-metal-bg span,
.bronze-badge-metal-bg span {
  font-size: inherit !important;
}

/* (Optional) Keep the logo on top and scale it with the badge */
.special-badge-logo {
  position: relative;
  z-index: 1;
  width: calc(var(--badge-size) * 0.55);
  height: auto;
}


  </style>
</head>
<body class="d-flex flex-column min-vh-100 gradient-bg">
  <%- include('partials/header') %>
  <div class="container my-4 flex-grow-1">
    <div class="row g-4">
      <!-- Left column -->
      <div class="col-md-4 text-white text-center d-flex flex-column align-items-center">
        <div class="badge-detail-wrapper">
          <%- include('partials/badgeIcon', { badge, team }) %>
        </div>
        <div class="diamond-text mt-3" style="font-size: 3rem; color:#ffffff">üíé <%= badge.pointValue %></div>
<h2 class="fw-bold text-start w-100"><%= badge.badgeName %></h2>
<p class="badge-description"><%= badge.description %></p>
      </div>

      <!-- Right column -->
      <div class="col-md-8 text-white">
        <!-- Users Section -->
        <div class="mb-5">
          <div class="d-flex align-items-center mb-2">
            <h4 class="fw-bold mb-0 me-2">Users with badge completed</h4>
            <span>(<%= usersCompleted.length %>)</span>
          </div>
          <div class="glassy-box">
            <% if (usersCompleted.length === 0) { %>
              <p class="mb-0">No users have completed this badge yet.</p>
            <% } else { %>
              <% usersCompleted.forEach(function(u){ %>
                <div class="d-flex align-items-center mb-2">
                  <img src="/users/<%= u._id %>/profile-image" class="avatar avatar-sm me-2">
                  <a href="/users/<%= u._id %>" class="text-white text-decoration-none"><%= u.username %></a>
                </div>
              <% }) %>
            <% } %>
          </div>
        </div>

        <!-- Upcoming Games Section -->
        <div>
          <h4 class="fw-bold text-white mb-2">Upcoming Games Toward Badge</h4>
          <hr class="border-light opacity-50">
          <div class="row row-cols-1 g-4">
            <% upcomingGames.forEach(function(game){
                 const awayColor = game.awayTeam && game.awayTeam.color ? game.awayTeam.color : '#ffffff';
                 const homeColor = game.homeTeam && game.homeTeam.color ? game.homeTeam.color : '#ffffff';
            %>
            <div class="col" data-id="<%= game._id %>">
              <a href="/games/<%= game._id %>" class="text-decoration-none">
                <div class="card shadow-sm h-100 game-card p-3 text-center position-relative" style="background: linear-gradient(to right, <%= awayColor %>, <%= homeColor %>);">
                  <div class="wishlist-wrapper">
                    <div class="wishlist-btn"><i class="bi <%= game.isWishlisted ? 'bi-heart-fill' : 'bi-heart' %>"></i></div>
                  </div>
                  <div class="game-date mb-2" data-start="<%= game.startDate.toISOString() %>"></div>
                  <div class="d-flex justify-content-between align-items-center position-relative mb-2 px-3">
                    <div class="logo-wrapper me-3">
                      <div class="team-logo-container">
                        <img src="<%= game.awayTeam && game.awayTeam.logos && game.awayTeam.logos[0] ? game.awayTeam.logos[0] : 'https://via.placeholder.com/60' %>" alt="<%= game.awayTeamName %>">
                      </div>
                      <span class="team-name"><%= game.awayTeamName %></span>
                    </div>
                    <div class="logo-wrapper ms-3">
                      <div class="team-logo-container">
                        <img src="<%= game.homeTeam && game.homeTeam.logos && game.homeTeam.logos[0] ? game.homeTeam.logos[0] : 'https://via.placeholder.com/60' %>" alt="<%= game.homeTeamName %>">
                      </div>
                      <span class="team-name"><%= game.homeTeamName %></span>
                    </div>
                    <div class="position-absolute top-50 start-50 translate-middle fw-bold fs-4 at-symbol">@</div>
                  </div>
                </div>
              </a>
            </div>
            <% }) %>
            <% if (upcomingGames.length === 0) { %>
              <p class="text-center">No upcoming games.</p>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function attachWishlistHandlers(){
      document.querySelectorAll('.wishlist-btn').forEach(btn=>{
        const icon = btn.querySelector('i');
        btn.dataset.saved = icon.classList.contains('bi-heart-fill') ? '1' : '0';
        btn.addEventListener('mouseenter', ()=>{
          if(btn.dataset.saved==='0'){
            icon.classList.remove('bi-heart');
            icon.classList.add('bi-heart-fill');
          }
        });
        btn.addEventListener('mouseleave', ()=>{
          if(btn.dataset.saved==='0'){
            icon.classList.add('bi-heart');
            icon.classList.remove('bi-heart-fill');
          }
        });
        btn.addEventListener('click',async function(e){
          e.preventDefault();
          e.stopPropagation();
          const col = btn.closest('.col');
          const gameId = col.dataset.id;
          const res = await fetch(`/games/${gameId}/wishlist`,{method:'POST'});
          if(!res.ok) return;
          const data = await res.json();
          icon.className = data.action==='added' ? 'bi bi-heart-fill' : 'bi bi-heart';
          btn.dataset.saved = data.action==='added' ? '1' : '0';
        });
      });
    }
    attachWishlistHandlers();
    document.querySelectorAll('.game-date[data-start]').forEach(el => {
      const date = new Date(el.dataset.start);
      el.textContent = new Intl.DateTimeFormat(navigator.language, { dateStyle: 'medium', timeStyle: 'short' }).format(date);
    });
  </script>
</body>
</html>
